---
apiVersion: v1
kind: Pod
metadata:
  name: webapp
spec:
  hostname: webapp-dev
  subdomain: demo-kubernetes
  volumes:
    - name: conjur-access-token
      emptyDir:
        medium: Memory

  containers:
  - name: authenticator
    image: webapp:local
    command: [ sleep, infinity ]
    env:
    - name: CONJUR_APPLIANCE_URL
      value: https://conjur-follower.conjur.svc.cluster.local/api
    - name: CONJUR_AUTHN_URL
      value: https://conjur-follower.conjur.svc.cluster.local/api/authn-k8s/minikube/default
    - name: CONJUR_ACCOUNT
      value: dev
    - name: CONJUR_AUTHN_LOGIN
      value: webapp
    - name: CONJUR_SSL_CERTIFICATE
      valueFrom:
        configMapKeyRef:
          name: webapp
          key: ssl_certificate
    volumeMounts:
    - mountPath: /run/conjur
      name: conjur-access-token
